<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Hacking on clojure.core & runtime</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<!-- <link rel="stylesheet" href="lib/css/monokai.css"> -->
		<link rel="stylesheet" href="css/theme/solarized.css" id="theme">

		<style>
			@font-face {
				font-family: 'Gill Sans';
				font-style: normal;
				font-weight: 400;
				src: url('/fonts/GillSans.ttf') format("truetype");
			}

			.reveal section img.plain {
			  width: 50%;
			}
	   
			.reveal section img.big {
			  width: 90%;
			}
	   
			.reveal,
			.reveal h1,
			.reveal h2,
			.reveal h3,
			.reveal h4,
			.reveal h5,
			.reveal h6 {
				font-family: 'Gill Sans', sans-serif !important;
			}

			.reveal section 	pre code {
				font-size: 4em;
				line-height: 1.5em;
				max-height: 600px;
			}

			section ul li {
				font-size: 1.55em;
			}

			.reveal section .borderless {
				border: none;
				box-shadow: none;
			}

			img.clj,
			img.razum2um,
			img.mad,
			img.map {
				height: 700px;
			}

			img.why {
				height: 900px;
			}

			img.miniclj {
				height: 300px;
			}

			img.minigolang {
				height: 300px;
			}

			.logos {
				position: absolute;
				display: flex;
				width: 1400px;
				top: 30%;
				justify-content: space-between;
				left: 13%;
			}

			.logos .minigolang {
				margin-top: 250px;
			}

			.disclaimer {
				font-size: 0.5em;
			}

			.flex {
				display: flex;
				justify-content: center;
				align-items: center;
			}

			.vflex {
				flex-direction: column;
			}

			.push-down {
				margin-top: 5em;
			}

			.reveal li {
				list-style-type: square;
			}

			.reveal .lower {
				text-transform: lowercase;
			}

			.reveal .capital {
				text-transform: capitalize;
			}

			.reveal .twophase,
			.reveal .gtrend {
				max-height: 500px;
			}
		</style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<img class='borderless clj' src='lib/images/clj.png' />
					<h1>Hacking on clojure.core & runtime</h1>
				</section>

				<section>
					<img src="lib/images/razum2um.jpg" alt="razum2um" class="borderless razum2um" />
					<h1>Vlad Bokov</h1>
					<a href="http://lunatic.cat">vlad@lunatic.cat</a>
					<aside class="notes">
						- we're doing outsource and continiously making things simpler(?)
					</aside>
				</section>

				<section>
					<img src="lib/images/mad.jpg" alt="mad" class="borderless mad" />
					<h1>Mad Bokov</h1>
					<a href="http://razum2um.me"></a>
					<aside class="notes">
						- like to give mad talks
					</aside>
				</section>

				<section data-markdown>
					<textarea data-template>
						# whoami
						
						- 5 yrs clojure developmemt
						- author of a few libs on clojars ~ 350 <3
						- [awesome-clojure](https://github.com/razum2um/awesome-clojure) list curator
						- [@razum2um](https://twitter.com/razum2um) - tweet mostly about clojure / functional code
						- [@hardcodefm](http://twitter.com/hardcodefm) host
					</textarea>
					<aside class="notes">
						sometimes during my talk there will be some advertisements (which we all love) which mention some awesome libraries which you may not know,
						but if you don't please, check them out. this also resembles me on my very old idea how to make people return to the talk after the confs, 
						so the slides will be published, links will be available
						and you won't be alble to adblock this (hahaha), sad story: I wasn't not paid for them
	
						also you could check my list of clojurian who you also may be interested to follow
					</aside>
				</section>

				<section>
					<h1>Origin</h1>
					<img src="lib/images/map.png" alt="map" class="borderless map" />
					<div class="fragment logos">
						<img class='borderless miniclj' src='lib/images/clj.png' />
						<img class='borderless minigolang' src='lib/images/golang-russian.png' />
					</div>
					<aside class="notes">
						- barnaul from moscow as far as go from clojure
					</aside>
				</section>

				<section>
					<h1>Psst, learn you some russian for the great good</h1>
					<aside class="notes">
						I'm glad the content of this talk will be available for all the clojure developers 

						russian is worth learning, as while speaking about programming languages I tend to suggest people learning clojure,
						I suggest lispers to learn russian, guest why? because russian talk in lisp (TODO: slide picture from chat)
						but lets get serious, lets talk about brackets
					</aside>
				</section>

				<section>
					<img class='borderless why' src='lib/images/why-russian.png' />
				</section>

				<section>
					<h1>Let's get serios (a poll)</h1>
					<ul>
						<li class="fragment">encountered a clojure bug</li>
						<li class="fragment">debugged clojure (JDWP etc)</li>
						<li class="fragment">changed something inside clojure internals</li>
						<li class="fragment">contributed back</li>
					</ul>
				</section>

				<section data-markdown>
					<textarea data-template>
						# Disclaimer

						- I will be speaking to different topics & my experience
						- Please, don't fork clojure for your production
						- Be open to possible insigths
						- Reopen slides tommorrow, checkout the links
					</textarea>
				</section>
	
				<section data-markdown>
					<textarea data-template>
						## Bugs

						- [261 bugs open atm](https://clojure.atlassian.net/browse/CLJ-2522?jql=project%20%3D%20CLJ%20AND%20issuetype%20%3D%20Bug%20AND%20status%20%3D%20Open%20AND%20resolution%20%3D%20Unresolved%20ORDER%20BY%20priority%20DESC)
						- [angry farewell letters]()
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
						# Poll

						```
						(def a -10000000000000)
						(Math/abs a) ;; => ?
						```
					</textarea>
					<aside class="notes">
						Follow me, don't miss the latest hottest bugs out there
					</aside>
				</section>

				<section data-markdown>
					<textarea data-template>
						# Answer

						- 1316134912
						- [CLJ-1921](https://clojure.atlassian.net/browse/CLJ-1921)
						- why?
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
						# Dynamic types + interop != magic

						```
						(def ^Long a -10000000000000)
						(Math/abs a)
						Syntax error (IllegalArgumentException) 
						More than one matching method found: abs
						```
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
						# Dynamic types + interop != magic

						- static double abs(double a)
						- static float abs(float a)
						- static int abs(int a)
						- static long abs(long a)
					</textarea>
				</section>
	
				<section>
					<h1>Go deeper</h1>
					<img src="lib/images/go-deeper.jpg" alt="godeeper" class="borderless godeeper" />
				</section>
	
					
				<section data-markdown>
					<textarea data-template>
						# Short intro into clojure source
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
						# Deal with

						- src/jvm/clojure/lang/Compiler.java
						- src/jvm/clojure/lang/LispReader.java
						- src/jvm/clojure/lang/RT.java
					</textarea>	
				</section>

				<section data-markdown>
					<textarea data-template>
						# Deal with

						- src/jvm/clojure/lang/Compiler.java - 9125 lines
						- src/jvm/clojure/lang/LispReader.java - 1699 lines
						- src/jvm/clojure/lang/RT.java - 2438

						- intended in a very *special* way
						- *almost* exclusively written by Rich
						- *almost* untouched after 2011
					</textarea>	
					<aside class="notes">
						holy rich!
					</aside>
				</section>

				<section data-markdown>
					<textarea data-template>
						## Compiler

						- recursive analyzeSeq => Expr
						- switch on Parser classes
						- interface IParser { Expr parse(C context, Object form) }
					</textarea>
				</section>
	
<!-- //////////////////  -->
        		
				<section data-markdown>
					<textarea data-template>
						# Unique: most flexible and language

						- close to ruby as per "change-anything" at runtime (but JVM final)
						- written in clear high-level language
						- *relatively* performant, [clojure-goes-fast](http://clojure-goes-fast.com/)
						- source is quite self-explanatory and educationable
					</textarea>
					<aside class="notes">
						- I'm keen to say that clj is the most flexible language (somewhere near ruby) I ever saw
						- doesn't require to think about memry management and c-extensions
						- as the parser is basically a depth-first tree walk - a good (just as any lisp)
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# WHY#1

						- I want to keep thinking in clojure 
						- use clojure fns, semantic, dynamism / jvm batteries
						- stay in REPL
						- not access REPL state from the editor
						- I care about my development flow
						- not just typings amount
						- about composability of little dirty pieces of code 
						- easy to explore
					</textarea>
					<aside class="notes">
						- I wont be talking about why evaling arbitrary sexps is bad, there's a very similar talk but about python notepads TODO link/slide
						- I just mention, that I use emacs and I use cider, but mainly only refresh and at most 1 sexp eval of test code afterwards
						- I dont eval 2 sexps 1 after another 
						- I done eval buffers files etc
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# WHY repl-first

						- copyable, immutable history
						- next command is conj
						- logged reproduce-ability
						- instead of dirty in-place reevaluation
						- TODO: ads cljsh
					</textarea>
					<aside class="notes">
						- I wont be talking about why evaling arbitrary sexps is bad, there's a very similar talk but about python notepads TODO link/slide
						- I just mention, that I use emacs and I use cider, but mainly only refresh and at most 1 sexp eval of test code afterwards
						- I dont eval 2 sexps 1 after another 
						- I done eval buffers files etc
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# WHY#2

						- no clojure fork, (holy rich!)
						- nothing strange inside the committed codebase
						- not selling anything to anybody
					</textarea>
					<aside class="notes">
						- just explaining how it works for me
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# why not CIDER / emacs plugin
						- use clojure / jvm batteries
						- stay in REPL
						- not access REPL state from the editor
						- 
						- explore
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
					  # lets talk about brackets
						
					  - search for fork
					  - count difff lines for that
					</textarea>
				</section>
				<!-- <section data-markdown>
					<textarea data-template>
					  # lets talk about issues
						
					  - search "quit" clojure articles
					  - count issues in jira
					  - talk about examples
					</textarea>
					<aside class="notes">
						but let's get deeper, 
						why would you need to change anything? maybe because something doesn't work for you
					</aside>
				</section> -->
				<section data-markdown>
					<textarea data-template>
						# lets talk about macros
						
						- still sexps
						- validated
						- not really a language, but DSL
					</textarea>
					<aside class="notes">
						
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# lets talk about read literals
						
						- beyond sexp
						- discouraged
					</textarea>
					<aside class="notes">
						
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# lets talk about regexps
						
						- instead of (->> coll (filter #(re-find #"smth" %))) 
						- you want this (->> coll (filter #"smth"))
					</textarea>
					<aside class="notes">
						TODO: slide about 1 more problem
						suppose you're often working in the repl and exploring data based on filtering of text values
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# lets talk about brackets
						
						- instead of `(->> coll (filter #"smth"))`
						- you want this `coll | filter #"smth"`
						- i.e. a `|` searches first fn after last `|`, if there's such arity => close bracket, go 1 level up (as may closing brackets possible), otherwise open a bracket
					</textarea>
					<aside class="notes">
						- yes you can, but I suggest to start looking at development of your own REPL instead of 
						- TODO: ads rebel-readline1
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# modify prev command
						
						- `(-> obj fn-returns-coll (->> (map f1))))
						- you want this `coll | filter #"smth"`
						- i.e. a `|` searches first fn after last `|`, if there's such arity => close bracket, go 1 level up (as may closing brackets possible), otherwise open a bracket
					</textarea>
					<aside class="notes">
						- does it reminds about bash pipe? yeah, bash pipe is awesome, unfortunately it's the only the single positive featute of bash and others 
						- TODO: ads clj-condo
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# lets talk about classloaders
						
						- java delegates search to parent first
						- clojure is different: top searched first
					</textarea>
					<aside class="notes">
						just to get on the same line - a couple of reminders how a typical classloader works in java
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# lets talk about origins
						
						- `{}`, `[]` are clojure.lang.IMeta
						- `String`, `Integer` etc are java native
					</textarea>
					<aside class="notes">
						I wanted to track origin of the hashes in order to be able not just print 
						I just remember you, that would just help me to write (oh god no, copypaste, we all love) tests for my function
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# lets talk about origins
						
						- `(def ring-req {...})
						- instead of this `(is (= {:a 1 :b {...}} (f ring-req)}))`
						- I wanted this `(is (= {:a 1 :b ring-req} (f ring-req)}))`
						- ideally I wanted to deduce the shortest possible path
						- without conditions
						- to merge constants, variables and arguments into a result
						- i.e. given a structure I wanted to ensure a presence of a unique codepath execution line corresponding to this
						- and express it in terms of assoc/dissoc/merge/conj/disj
					</textarea>
					<aside class="notes">
						I wanted to track origin of the hashes in order to be able not just print 
						I just remember you, that would just help me to write (oh god no, copypaste, we all love) tests for my function
						vars are changing but why
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						# let's talk about startup time
						
						- `time clj -e ''`
						- takes	2.06s on my MBP
						- clj -A / lein repl / etc on a repl project
						- takes forever
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						# ideas
						
						- don't restart repl
						- TODO: ads pomergranate
						- persistent jvm
						- TODO: link to why androind slow -> core
						- reduce core by physically deleting functions
						- what if we gather eveything on runtime and assume that we don't eval 
						- again - it's DEVELOPMENT clojure build, don't use on prod
						- TODO: ads dunaj
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						# fin
						
						- dream big
						- change and adapt your tools for yourself
						- think globally
						- act locally
					</textarea>
				</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				width: 2400,
				height: 1800,
				history: true,
				controls: false,
				fragments: true,
				progress: true,
				center: true,
				touch: true,
				transition: 'fade', // none/fade/slide/convex/concave/zoom
				// keyboard: {
				// 	85: uChoice, // u
				// 	68: dChoice,  // d
				// 	49: uChoice, // u, "1"
				// 	50: dChoice,  // d, "2"
				// 	82: rChoice, // r
				// 	78: nChoice, // n
				// 	80: pChoice, // p
				// 	72: goToHell  // h
				// },
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
